<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Debug</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div style="background: red; color: white; padding: 10px; text-align: center;">
        <h2>üîß DEBUG MODE - SETTINGS</h2>
    </div>

    <div id="debugLog" style="background: #f0f0f0; padding: 10px; margin: 10px; border: 1px solid #ccc; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
        <strong>Debug Log:</strong><br>
    </div>

    <!-- Teste simples -->
    <div style="padding: 20px; border: 2px solid #007bff; margin: 20px;">
        <h3>üß™ Teste Simples</h3>
        <input type="text" id="testInput" placeholder="Digite algo..." style="padding: 5px; margin-right: 10px;">
        <button onclick="testSimpleFunction()" style="padding: 5px 10px; background: green; color: white; border: none;">
            Teste Simples
        </button>
        <br><br>
        <button onclick="testCategoryFunction()" style="padding: 5px 10px; background: blue; color: white; border: none;">
            Teste addCustomCategory
        </button>
    </div>

    <!-- Teste das categorias -->
    <div style="padding: 20px; border: 2px solid #28a745; margin: 20px;">
        <h3>üí∞ Teste Categoria Income</h3>
        <input type="text" id="newIncomeCategory" placeholder="z.B. Catering-Privat" style="padding: 5px; margin-right: 10px;">
        <button onclick="debugAddFinancialCategory('income')" style="padding: 5px 10px; background: #28a745; color: white; border: none;">
            + Hinzuf√ºgen (DEBUG)
        </button>
    </div>

    <script src="../js/eventBus.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // Fun√ß√£o de log
        function debugLog(message) {
            console.log('[DEBUG] ' + message);
            const logDiv = document.getElementById('debugLog');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Teste simples
        function testSimpleFunction() {
            const input = document.getElementById('testInput');
            const value = input.value;
            debugLog('‚úÖ testSimpleFunction chamada com valor: ' + value);
            alert('Fun√ß√£o funciona! Valor: ' + value);
        }

        // Teste da fun√ß√£o addCustomCategory
        function testCategoryFunction() {
            debugLog('üß™ Testando addCustomCategory...');
            
            try {
                // Verificar se as fun√ß√µes existem
                debugLog('addCustomCategory existe: ' + (typeof addCustomCategory !== 'undefined'));
                debugLog('getCurrentRestaurant: ' + getCurrentRestaurant());
                debugLog('getCurrentRestaurantData existe: ' + (getCurrentRestaurantData() ? 'SIM' : 'N√ÉO'));
                
                // Tentar adicionar uma categoria
                const result = addCustomCategory('financial', 'teste_debug', 'Categoria Debug', 'income');
                debugLog('Resultado addCustomCategory: ' + result);
                
            } catch(error) {
                debugLog('‚ùå ERRO: ' + error.message);
            }
        }

        // Vers√£o debug da addFinancialCategory
        function debugAddFinancialCategory(type) {
            debugLog('üéØ debugAddFinancialCategory chamada com tipo: ' + type);
            
            try {
                const input = document.getElementById(`new${type.charAt(0).toUpperCase() + type.slice(1)}Category`);
                debugLog('Input encontrado: ' + (input ? 'SIM' : 'N√ÉO'));
                
                if (!input) {
                    debugLog('‚ùå Input n√£o encontrado!');
                    return;
                }
                
                const label = input.value.trim();
                debugLog('Valor do input: "' + label + '"');
                
                if (!label) {
                    debugLog('‚ö†Ô∏è Label vazio');
                    alert('Bitte geben Sie einen Kategorienamen ein');
                    return;
                }

                const value = label.toLowerCase().replace(/[^a-z0-9]/g, '_');
                debugLog('Valor gerado: "' + value + '"');
                
                debugLog('Chamando addCustomCategory...');
                const result = addCustomCategory('financial', value, label, type);
                debugLog('Resultado: ' + result);
                
                if (result) {
                    input.value = '';
                    debugLog('‚úÖ Categoria adicionada com sucesso!');
                    alert('Categoria adicionada: ' + label);
                } else {
                    debugLog('‚ùå Falha ao adicionar categoria');
                    alert('Erro ao adicionar categoria');
                }
                
            } catch(error) {
                debugLog('‚ùå ERRO na fun√ß√£o: ' + error.message);
                alert('Erro: ' + error.message);
            }
        }

        // Log inicial
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ P√°gina carregada');
            debugLog('EventBus existe: ' + (typeof eventBus !== 'undefined'));
            debugLog('main.js carregado: ' + (typeof loadDataFromStorage !== 'undefined'));
            
            // Carregar dados
            try {
                loadDataFromStorage();
                debugLog('‚úÖ loadDataFromStorage executado');
            } catch(error) {
                debugLog('‚ùå Erro loadDataFromStorage: ' + error.message);
            }
        });
    </script>
</body>
</html> 